#!/bin/bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=/dev/null
source "$SCRIPT_DIR/lane_b_common.sh"
lane_b_init

echo "Step 0a (Lane B wrapper): running generic baseline seeds ..."

export BASELINE_WORK_DIR="$LANE_B_BASELINE_WORK_DIR"
export BASELINE_RESULTS_DIR="$LANE_B_BASELINE_RESULTS_DIR"
export BASELINE_RESULTS_CSV="$LANE_B_BASELINE_RESULTS_CSV"
export BASELINE_SEEDS="$LANE_B_BASELINE_SEEDS"
export BASELINE_REQUIRED_SEEDS="$LANE_B_BASELINE_SEEDS"
export BASELINE_NUM_ITERATIONS="$LANE_B_BASELINE_NUM_ITERATIONS"
export BASELINE_WANDB_RUN_BASE="$LANE_B_WANDB_RUN_BASE"
export BASELINE_DEPTH="$LANE_B_DEPTH"
export BASELINE_ASPECT_RATIO="$LANE_B_ASPECT_RATIO"
export BASELINE_HEAD_DIM="$LANE_B_HEAD_DIM"
export BASELINE_MAX_SEQ_LEN="$LANE_B_MAX_SEQ_LEN"
export BASELINE_DEVICE_BATCH_SIZE="$LANE_B_DEVICE_BATCH_SIZE"
export BASELINE_TOTAL_BATCH_SIZE="$LANE_B_TOTAL_BATCH_SIZE"
export BASELINE_EVAL_EVERY="$LANE_B_EVAL_EVERY"
export BASELINE_EVAL_TOKENS="$LANE_B_EVAL_TOKENS"
export BASELINE_CORE_METRIC_EVERY="-1"
export BASELINE_DEFAULT_RATIO="$LANE_B_DEFAULT_RATIO"
export BASELINE_TARGET_METRIC="$LANE_B_TARGET_METRIC"
export BASELINE_RUN_LABEL_PREFIX="baseline_d${LANE_B_DEPTH}"

bash "$SCRIPT_DIR/baseline_step1_run_true_baselines.sh"
